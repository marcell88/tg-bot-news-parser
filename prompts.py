# Константы для промптов, используемых в запросах к Large Language Models (LLM).
from typing import Dict, Any
import os
from dotenv import load_dotenv

# Явно загружаем .env файл
load_dotenv()

# Получаем переменные с преобразованием к нужному типу
ESSENCE_THRESHOLD = float(os.getenv('ESSENCE_THRESHOLD', 7.5))
ADJ_THRESHOLD = float(os.getenv('ADJ_THRESHOLD', 8.5))
FINAL_SCORE_THRESHOLD = float(os.getenv('FINAL_SCORE_THRESHOLD', 8.5))
CONTEXT_THRESHOLD = float(os.getenv('CONTEXT_THRESHOLD', 6))
MIN_SCORE_THRESHOLD = float(os.getenv('MIN_SCORE_THRESHOLD', 8))


# --- 1. ПЕРВАЯ ФИЛЬТРАЦИЯ - убираем плохие темы

FILTER_INITIAL = """

Задача: Проанализируй текст новости и определи, нужно ли её фильтровать (отклонять) на основе критериев, описанных ниже.
Не додумывай никакие свое критерии - оперируй только тем, что явно здесь указано.

===
ГЛАВНЫЙ ПРИНЦИП:
Новость отклоняется, если относится к запретной теме или представляет собой малоинформативное сообщение (недостаточно контекста понять вообще о чем она).

Запретные темы: Новость фильтруется только если она непосредственно, в явном виде и по своей основной сути и цели посвящена описанию, обсуждению или продвижению какой-либо запретной темы. Если тема упоминается косвенно, контекстно, как пример или как часть более широкого обсуждения (особенно аналитического, экономического или культурного) — фильтрация НЕ применяется.

Низкая информативность: Новость фильтруется, если она представляет собой сообщение, из которого мало что понятно относительно ее сути и смысла, недостаточно контекста, мало информации в самом сообщении.

Не додумывай никакие свое критерии - оперируй только тем, что явно здесь указано.
Более детально критерии фильтрации указаны ниже.

===
СПИСОК ЗАПРЕТНЫХ ТЕМ:
Если новость по основной сути посвящена или подробно описывает хотя бы одну из следующих тем, она должна быть отклонена.

Категория А: Трагедии и насилие
1.  Конкретные репортажи о случаях с смертельным исходом или получением физических травм. 
2.  Новости о преднамеренном убийстве, жестоком обращении, мучениях или гибели животных. 
3.  Сообщения о конкретных совершенных, предотвращенных или готовящихся терактах. 
4.  Подробные отчеты о конкретных преступлениях или судебных процессах, связанных с изнасилованием и преступлениями сексуального характера.
5.  Конкретные сообщения о ситуациях, где жизни детей, беременных, инвалидов или стариков угрожает непосредственная опасность (пожары, теракты, нападения).
6.  Репортажи с мест природных и техногенных катастроф (землетрясения, наводнения, аварии на производствах) с описанием разрушений, эвакуации и жертв.
7.  Авиапроисшествия и ДТП с жертвами: Новости о конкретных инцидентах, где есть погибшие или раненые.

Категория Б: Военная тематика и последствия
8.  Сводки о текущих боевых действиях: Оперативные отчеты с линии фронта, тактические описания боев, перемещений войск.
9.  Страдания мирного населения на войне: Репортажи о гибели, ранениях, лишениях и гуманитарных кризисах среди гражданского населения в зонах конфликтов.
10. Проблемы ветеранов со здоровьем: Подробные истории о тяжелых физических и психологических травмах (ПТСР, ампутации), полученных в ходе боевых действий. 
11. Последствия атак с жертвами: Описание результатов ракетных, артиллерийских или иных атак с акцентом на человеческие жертвы и разрушения.
12. Атаки беспилотников (БПЛА, БЭК, дроны, безэкипажные катера): Новости о конкретных атаках с применением дронов, их последствиях (жертвы, разрушения) или сбитии.
13. Военные диверсии и их последствия: Сообщения о подрывах, саботаже и их результатах (жертвы, разрушения).
14. Новости про поимку или обвинение людей в государственной измене, оправдание терроризма, если это основная тема.
15. Новости про планы или проведение мобилизации в России или на Украине как основная тема.

Категория В: Социально-чувствительные темы
16. Аборты: Новости, напрямую посвященные практике абортов, законодательным изменениям по их регулированию или акциям за/против.
17. Чечня и семья Кадыровых: Новости, где Чеченская Республика ИЛИ члены семьи Кадыровых являются главной и центральной темой материала.
18. ЛГБТ-пропаганда: Материалы, открыто пропагандирующие, позитивно освещающие или призывающие к принятию ЛГБТ-отношений и ценностей.
19. Педофилия и порнография: Репортажи о конкретных преступлениях сексуального характера против несовершеннолетних или материалы, связанные с детской порнографией.
20. Оскорбление религиозных чувств: Новости о конкретных актах осквернения религиозных символов, мест поклонения или издевательствах над верованиями.
21. Включение кого-то в список экстремистов, террористов, иноагентов как основная тема сообщения.
22. Конкретные репортажи о случаях физического, психологического насилия над детьми в семье, учреждениях.
23. Сообщения об ущемлении или борьбе с ущемлением прав по признакам: гендерное равноправие, национальные меньшинства, трансгендерность — если это является основной темой и подано в активистском или скандальном ключе.

===
КРИТЕРИИ И ПРИЗНАКИ МАЛОЙ ИНФОРМАТИВНОСТИ СООБЩЕНИЯ
1. По сообщению вообще не понятно хотя бы примерно о чем оно (тема, смысл, контекст).
2. Если основная тема и смысл сообщения - рекламные и маркетинговые материалы, откровенный пиар товаров, услуг, персон (просто призыв подписаться или перейти по ссылке не является рекламой).
3. Дайджесты новостей - сводки из нескольких разнородных новостей без единой темы.

===
ВАЖНЫЕ ИСКЛЮЧЕНИЯ
1) Не отклоняй новости даже если они формально относятся к запретным темам, если данная запретная упоминается в более широком контексте и не является основной темой новости. Например, статистика и аналитические материалы, общие дискуссии о разных общественных проблемах, обсуждение законов и политики, и прочее.
2) Только лишь форма подачи (например, грубые выражения) - не является причиной для фильтрации (отклонения).
3) Призыв в конце какой-то новости подписаться на ресурс или канал, или перейти по ссылке - не является признаком рекламного сообщения.

===
ИНСТРУКЦИЯ К ДЕЙСТВИЮ И ФОРМАТ ОТВЕТА:
1.  Внимательно прочти новость и определи её ОСНОВНУЮ СУТЬ и ЦЕЛЬ.
2.  Если основная суть новости прямо и явно соответствует хотя бы одному критерию из разделов "Запретные темы" или если сама новость относится к категории "Малоинформативной", то отметь ее как потенциальную для фильтрации (исключения).
3.  Посмотри внимательно на "ВАЖНЫЕ ИСКЛЮЧЕНИЯ" - применимо ли они.
4.  Сформируй ответ:
    - Если новость подпадает под критерии фильтрации (отклонения) и НЕ подпадает под важное исключение, то:
        filter - false
        explain - 1-2 предложения, укажи номер или суть нарушенного пункта (например: "П.6: сообщение")
    - Если новость НЕ подпадает под критерии фильтрации (отклонения), или если подпадает под важные исключения, то:
        filter - true
        explain - 1-2 предложения, объясни, почему новость прошла фильтр

Всегда отвечай строго в формате JSON:
{
  "filter": true,
  "explain": "Объяснение вашего решения."
}

"""

FILTER_INITIAL_SCHEMA: Dict[str, Any] = {
    "type": "object",
    "properties": {
        "filter": {
            "type": "boolean",
            "description": "Финальное решение: true (сообщение проходит фильтр) или false (сообщение не проходит фильтр) в соответствии с критериями FILTER_INITIAL."
        },
        "explain": {
            "type": "string",
            "description": "Краткое объяснение принятого решения (1-2 предложения), с указанием конкретного пункта нарушения, если filter=false."
        }
    },
    "required": ["filter", "explain"],
    "additionalProperties": False
}


# --- 3. ТРЕТЬЯ ФИЛЬТРАЦИЯ - фильтруем по сути

ESSENCE_FILTRATION = """

## ЗАДАЧА

Проанализируй новость и оцени уровень её интерсности (по шкале от 0 до 10).
Критерии "интересности" более детально описаны ниже

## КРИТЕРИИ ИНТЕРЕСНОСТИ
(не полный список - можешь также смотреть и анализировать со своей стороны)

1) Важность — от события зависят жизни, деньги или безопасность большого количества людей. Это не рядовой случай, а то, что повлияет на многих всерьез и надолго.
2) Универсальность — локальная история бьет в тему, знакомую каждому. Читатель узнает в чужой беде свою и думает: «это могло случиться и со мной».
3) Юмор — ситуация абсурдная, нелепая или настолько глупая, что похожа на сатиру. Сарказм автора, ирония судьбы или просто жизненный фарс, от которого хочется улыбнуться.
4) Эмоции — новость задевает за живое: бесит, пробивает на слезу, умиляет или восхищает. Ты не просто прочитал, ты почувствовал.
5) Герои — человек с необычной судьбой, поступком или характером. Это может быть звезда, старик-бунтарь, ребенок-гений или тот, кто сделал то, на что другие не решились.
6) Ситуация — сама история разворачивается как сценарий к фильму. Есть завязка, кульминация, повороты — это не статика, а драма в действии.
7) Необычность — то, что случилось, выбивается за пределы нормы. Рекорд, аномалия, прецедент — впервые за сто лет, единственный в мире, такого просто не бывает.
8) Конфликт — открытое противостояние сторон с понятными интересами. Драка в думе, суд многодетной с мэрией, разнос в эфире — есть напряжение и искры.
9) Польза — новость содержит информацию, которую читатель применит к себе. Изменились законы, выросли налоги, появилась новая схема мошенников — это не просто знать, это жить.
10) Тайна/интрига — у истории нет развязки, есть версии, загадки и белые пятна. Читатель остается с вопросом и хочет вернуться, чтобы узнать продолжение.
11) Визуал — новость рождает картинку в голове или уже существует в видео/фото. Пожар, драка, природа, эмоциональный кадр — это кликнут глазами, даже не читая заголовок.

## МЕТОДОЛОГИЯ ОЦЕНКИ
- 10 баллов — это не «все включено». 10 баллов — это когда либо один критерий уничтожает наповал, либо несколько работают в связке и усиливают друг друга.
- Идеальных новостей не бывает. Бывают новости, которые невозможно пропустить.
- Примерная шкала оценок
    0–1 балла — Новость не соответствует ни одному критерию, это пустота или полная рутина.
    2–3 балла — Один критерий едва заметен, остальных нет, новость прочитали и забыли.
    4–5 баллов — Один критерий звучит внятно, либо два-три слабо, но в целом читабельно.
    6–7 баллов — Один критерий сработал сильно, остальные не важны, новость запоминается.
    8–9 баллов — Один критерий бьет в яблочко, новость цитируют и обсуждают.
    10 баллов — Один критерий уничтожает, плюс минимум два-три поддерживают, это событие невозможно пропустить.

## ФОРМАТ ОТВЕТА
- В поле essence_score напиши общую оценку интересности новости (с учетом всех критериев) от 0 до 10
- В поле essence_explain напиши краткие комментарий и оценки по всем критериям

```json
{
  "essence_score": 7,
  "essence_explain": "3-4 предложения с кратким описанием и обоснованием оценки"
}

"""

ESSENCE_FILTRATION_SCHEMA: Dict[str, Any] = {
    "type": "object",
    "properties": {
        "essence_score": {
            "type": "number",
            "description": "Оценка социальной значимости новости (0-10)"
        },
        "essence_explain": {
            "type": "string", 
            "description": "Перечислить оценки по критериям и дать общее краткое пояснение (2-3 предложения)"
        }
    },
    "required": [
        "essence_score",
        "essence_explain"
    ],
    "additionalProperties": False
}


TAGED_PROMPT = """

Проанализируй текст и создай 5 тегов, описывающих данный текст максимально уникальным образом:

1. **ТЭГ 1** (Люди?) → перечисли людей (действующие лица, комментаторы, наблюдатели и пр.), которые упоминаются в тексте
- Если есть хоть одно собственное имя - то используй только имена собственные
- Не более 3 лиц
- Приведи их общепринятые краткое наименование (например, только фамилию, или краткое название страны или компании).
- Расположи их по алфавиту

2. **ТЭГ 1** (Организации?) → перечисли названия организаций, брендов, марок продукции и прочих уникальных наименований (компании, международные организации, политические партии, марки авто, название оружия и прочее), которые упоминаются в тексте
- Не упоминай названия СМИ (исключение - если сама новость посвящена СМИ)
- Если есть хоть одно собственное имя - то используй только имена собственные
- Не более 3 названий организеций
- Приведи их общепринятые краткое наименование (например,  Apple, Tesla, ЦБ РФ).
- Расположи их по алфавиту

3. **ТЭГ 3** (Локации?) → опиши реальные локации (страны, города, площадки, мероприятия, форумы), которые упоминаются в тексте
- Если есть хоть одно собственное имя - то используй только имена собственные
- Не более трех локаций, в приоритете более конкретные (например, если можно указать и "Москва", и "Россия" - то указать только "Москва")
- Используй только общепринятые краткие названия на русском языке (например, "Россия", а не "Российская Федерация", или "США", а не "Соединенные Штаты Америки).
- Расположи их по алфавиту.

4. ТЭГ 4 (ключевые слова?) → укажи 3 ключевых слова, которые упоминаются в тексте
- Это не должны быть имена собственные или служебные части речи
- Проанализируй каждое слово (кроме служебных и нарицательных) по частоте использования в русском языке
- Выбери три разных ключевых слова, которые наименее часто используются в русском языке
- Расположи их в именительном падеже (или в виде инфинитива если это глагол), в алфавитном порядке

5. ТЭГ 5 (Основная тема? Что происходит?) → напиши основную тему даной новости, ключевой процесс/событие, которое произошло или происходит (одним словом или одним законченным словосочетанием)

**Правила:**
- Используй только текст новости не домысливай
- Если инфрмации нет по какому-то тэгу явно в новости нет - просто верни строку "нет информации"

## ФОРМАТ ОТВЕТА
```json
{
  "tag1": "Сечин, Шульгинов",
  "tag2": "CNPC, Роснефть",
  "tag3": "Сочи, Усть-Луга", 
  "tag4": "Диверсификация, меморандум, углеводороды",
  "tag5": "Строительство нефтехимического комбината"
}

"""

TAGED_SCHEMA: Dict[str, Any] = {
    "type": "object",
    "properties": {
        "tag1": {
            "type": "string",
            "description": "Люди"
        },
        "tag2": {
            "type": "string", 
            "description": "Организации"
        },
        "tag3": {
            "type": "string",
            "description": "Места"
        },
        "tag4": {
            "type": "string",
            "description": "Слова"
        },
        "tag5": {
            "type": "string",
            "description": "О чем"
        }
    },
    "required": [
        "tag1",
        "tag2", 
        "tag3",
        "tag4",
        "tag5"
    ],
    "additionalProperties": False
}

SHORTEN_PROMPT = """

## ИНСТРУКЦИЯ
Перескажи кратко (не более 2-3 предложений) о чем это сообщение, которое написано ниже. 
Сохрани стиль самого сообщения.

## ФОРМАТ ОТВЕТА
ответ в виде строки (короткий пересказ новости)

"""

SHORTEN_SCHEMA: Dict[str, Any] = {
    "type": "object",
    "properties": {
        "short_text": {
            "type": "string", 
            "description": "короткий пересказ новости"
        }
    },
    "required": ["short_text"]
}

MYTH_PROMPT = """

Ты — литературный редактор. Оцени новость на её потенциал для создания художественного комментария в стиле известных писателей.

## КРИТЕРИИ ОЦЕНКИ ПОТЕНЦИАЛА НОВОСТИ

### 1. БОГАТСТВО КОНФЛИКТОВ (вес 1.3)
Наличие противоречий для художественного осмысления:
- 10: Многоуровневые конфликты (личные, социальные, моральные, экзистенциальные)
- 9: Глубокие многослойные конфликты с эмоциональной напряженностью
- 8: Ясные центральные противоречия с сильным потенциалом развития
- 7: Определенные конфликты с умеренной сложностью
- 6: Один основной конфликт без значительной глубины
- 5: Базовый конфликт с ограниченным развитием
- 4: Слабые, поверхностные противоречия
- 3: Минимальные признаки конфликта
- 2: Едва различимые противоречия
- 1-0: Конфликт отсутствует

### 2. ПОТЕНЦИАЛ ДЛЯ СТИЛИЗАЦИИ (вес 1.2)
Возможности для интерпретации в разных литературных стилях:
- 10: Идеально подходит для 5+ различных стилей с богатыми возможностями
- 9: Отлично ложится в 4-5 различных стилей
- 8: Хорошо подходит для 3-4 стилей с разнообразием подходов
- 7: Уверенно работает в 2-3 стилях
- 6: Подходит для 1-2 стандартных подходов
- 5: Ограниченный выбор стилей
- 4: Слабые возможности для стилизации
- 3: Минимальный потенциал для художественной обработки
- 2: Единичные возможности стилизации
- 1-0: Не поддается художественной стилизации

### 3. ГЛУБИНА ТЕМЫ (вес 1.1)
Возможности для раскрытия универсальных тем:
- 10: Затрагивает фундаментальные экзистенциальные темы
- 9: Глубоко раскрывает универсальные человеческие проблемы
- 8: Позволяет раскрыть значимые социальные/моральные вопросы
- 7: Достаточная глубина для серьезного осмысления
- 6: Ограниченный тематический потенциал
- 5: Базовые темы без развития
- 4: Поверхностная тематика
- 3: Минимальная тематическая ценность
- 2: Едва различимые темы
- 1-0: Тематически бедный материал

### 4. ОБРАЗНЫЙ ПОТЕНЦИАЛ (вес 1.0)
Возможности для создания метафор и символов:
- 10: Богатая почва для создания сложных символических систем
- 9: Мощный потенциал для многоуровневых метафор и аллегорий
- 8: Позволяет построить выразительные метафоры и символы
- 7: Хорошие возможности для образного осмысления
- 6: Ограниченный образный потенциал
- 5: Базовые возможности для метафоризации
- 4: Минимальные возможности для образности
- 3: Слабый образный потенциал
- 2: Единичные возможности для образов
- 1-0: Фактографический материал без образного потенциала

### 5. ДРАМАТУРГИЧЕСКАЯ ЗАВЕРШЕННОСТЬ (вес 1.0)
Наличие естественной драматургической дуги:
- 10: Готовая драматургическая структура с полной аркой и катарсисом
- 9: Завершенная драматургия с эмоциональной кульминацией
- 8: Ясная драматургическая основа для развития с сильной завязкой
- 7: Определенная драматургическая структура с потенциалом
- 6: Фрагментарная драматургия, требует доработки
- 5: Базовые драматургические элементы
- 4: Слабая драматургическая основа
- 3: Минимальные признаки драматургии
- 2: Едва различимая структура
- 1-0: Отсутствие драматургической структуры

## МЕТОДОЛОГИЯ ОЦЕНКИ
- Оценивай СЫРУЮ НОВОСТЬ, а не возможный комментарий
- Представляй, как эту новость могли бы обыграть разные писатели
- Фокусируйся на том, какие литературные возможности заложены в материале
- Учитывай потенциал для разных жанров и стилей

## ФОРМУЛА РАСЧЕТА:
(К1 * 1.3 + К2 * 1.2 + К3 * 1.1 + К4 * 1.0 + К5 * 1.0) / 5.6

Верни ответ в формате JSON с полем "myth_score" содержащим итоговый балл от 0.0 до 10.0.

## ПРИМЕРЫ ОЦЕНОК:
- Скандал с политиком + человеческая драма: 8.4
- Технологический прорыв с этическими дилеммами: 7.8
- Обычная бюрократическая новость: 4.2
- Сухой статистический отчет: 2.1

**Пример вывода:** {"myth_score": 8.5}

"""

MYTH_SCHEMA: Dict[str, Any] = {
    "type": "object",
    "properties": {
        "myth_score": {
            "type": "number",
            "description": "Оценка соответствия текста архетипическим сюжетным структурам от 0.0 до 10.0"
        }
    },
    "required": ["myth_score"]
}
